(this["webpackJsonpfacemask-detection"]=this["webpackJsonpfacemask-detection"]||[]).push([[0],{328:function(e,t,n){},334:function(e,t){},335:function(e,t){},343:function(e,t){},353:function(e,t){},354:function(e,t){},355:function(e,t){},356:function(e,t){},364:function(e,t){},365:function(e,t,n){},370:function(e,t,n){"use strict";n.r(t);var a=n(11),c=n.n(a),r=n(133),i=n.n(r),s=(n(328),n(76)),o=n(12),l=n(4),u=n(5),d=n.n(u),h=n(418),f=n(416),b=n(421),j=n(419),g=n(415),m=n(413),v=n(417),p=n(87),x=n(314),O=n.n(x),w=(n(365),{root:{height:"100vh",width:"100vw",display:"flex",alignItems:"stretch",backgroundColor:"#E6EE9C",flexDirection:"column"},webCamParentPanel:{width:"100%",backgroundColor:"#C5CAE9",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"row",margin:0,padding:0,gap:0},webCamPanel:{display:"flex",height:"100%",backgroundColor:"#FFF59D",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0},settingPanel:{display:"flex",height:"100%",backgroundColor:"#FFF59D",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0},faceMaskPanel:{display:"flex",backgroundColor:"#BBDEFB",justifyContent:"space-evenly",alignItems:"center",margin:0,padding:0,gap:0},faceMaskContainer:{display:"flex",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0,flexDirection:"column"},webCamStackItem:{position:"absolute",top:0,left:0,marginLeft:"auto"}});function y(){var e=window.visualViewport;return{width:e.width,height:e.height}}var I=function(e,t,n,a,c,r,i){for(var s=[],o=0,l=e.length;o<l&&!(e[o]<t);){var u=[],d=n[0][o][0]*a,h=n[0][o][1]*c,f=n[0][o][2]*a,b=n[0][o][3]*c;u[0]=h,u[1]=d,u[2]=b-h,u[3]=f-d;var j=parseInt(n[0][o][0]*r),g=parseInt(n[0][o][1]*i),m=[j,g,parseInt(n[0][o][2]*r)-j+1,parseInt(n[0][o][3]*i)-g+1];s.push({label:"face",score:e[o],bbox:u,slideBox:m,cropBox:n[0][o],boxInd:o}),o++}return s},C=function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=3;break}return console.log("enumerateDevices() not supported."),e.abrupt("return",[{deviceName:null,deviceId:null}]);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0,a=e.length;n<a;)"videoinput"===e[n].kind&&t.push({deviceName:e[n].label,deviceId:e[n].deviceId}),n++;return t})).catch((function(e){return console.log(e.name+": "+e.message),[{deviceName:null,deviceId:null}]}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var k=n(19),S=[16/9,4/3],P="".concat("/facemask-detection","/tfjs/face_detection/model.json"),W="".concat("/facemask-detection","/tfjs/face_mask_classification/model.json"),F="".concat("/facemask-detection","/test_imgs/mask_01.jpg");var D=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(Array(5).fill(0)),n=Object(a.useState)(0),c=Object(l.a)(n,2),r=c[0],i=c[1],u=Object(a.useState)(0),x=Object(l.a)(u,2),D=x[0],E=x[1],B=Object(a.useState)([]),M=Object(l.a)(B,2),H=M[0],A=M[1],R=Object(a.useState)([]),N=Object(l.a)(R,2),_=N[0],z=N[1],L=Object(a.useState)(null),V=Object(l.a)(L,2),J=V[0],T=V[1],Q=Object(a.useState)(null),q=Object(l.a)(Q,2),G=q[0],K=q[1],U=Object(a.useState)({}),X=Object(l.a)(U,2),Y=X[0],Z=X[1],$=Object(a.useState)(!1),ee=Object(l.a)($,2),te=ee[0],ne=ee[1],ae=Object(a.useState)({deviceName:"",deviceId:""}),ce=Object(l.a)(ae,2),re=ce[0],ie=ce[1],se=Object(a.useState)([]),oe=Object(l.a)(se,2),le=oe[0],ue=oe[1],de=function(){var e=Object(a.useState)(y()),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){function e(){c(y())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),he=de.height,fe=de.width,be=function(e,t,n,a,c){var r=e*n/100,i=t*a/100,s=i/c[0],o=r*c[0],l=r,u=i;return s>r?u=o:l=s,{webCamPanelWidth:i,webCamPanelHeight:r,expectedWebCamWidth:u,expectedWebCamHeight:l}}(he,fe,65,70,S),je=be.webCamPanelWidth,ge=be.webCamPanelHeight,me=be.expectedWebCamWidth,ve=be.expectedWebCamHeight,pe=function(e,t,n,a){var c=e/t,r=n/c,i=a,s=n;return r>a?s=a*c:i=r,{expectedImgWidth:s,expectedImgHeight:i}}(void 0!==Y.oriImgWidth?Y.oriImgWidth:0,void 0!==Y.oriImgHeight?Y.oriImgHeight:1,je,ge),xe=pe.expectedImgWidth,Oe=pe.expectedImgHeight,we=35*he/100*.5,ye={height:720,width:1280,deviceId:re.deviceId},Ie=function(){var e=Object(o.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==J&&J.dispose(),null!==G&&G.dispose(),e.next=4,p.e(P,{onProgress:function(e){i(e)}});case 4:return t=e.sent,e.next=7,p.e(W,{onProgress:function(e){E(e)}});case 7:return n=e.sent,T(t),K(n),console.log("Model loaded."),e.abrupt("return",[t,n]);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(){var n=Object(o.a)(d.a.mark((function n(a,c){var r,i,s,o,l,u,h,f,b;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=a&&null!=c){n.next=2;break}return n.abrupt("return");case 2:if("undefined"===typeof e.current||null===e.current||4!==e.current.video.readyState){n.next=15;break}i=e.current.video,r=document.getElementById("myCanvas"),e.current.video.width=me,e.current.video.height=ve,r.width=me,r.height=ve,s=ve,o=me,l=720,u=1280,n.next=16;break;case 15:return n.abrupt("return");case 16:h=r.getContext("2d"),"16px sans-serif",h.font="16px sans-serif",h.textBaseline="top",f=p.a.fromPixels(i),b=p.g((function(){return f.transpose([0,1,2]).expandDims()})),a.executeAsync(b).then((function(e){var n,a,r,i=e[4].arraySync(),d=e[6].dataSync(),b=I(d,.5,i,s,o,l,u),j=Array(5).fill(null),g=Array(5).fill(null);if(b.length>0){for(n=0,a=b.length,r=5,h.clearRect(0,0,ve,me);n<a;){var m=b[n].bbox[0],v=b[n].bbox[1],x=b[n].bbox[2],O=b[n].bbox[3];h.strokeStyle="#00FFFF",h.lineWidth=2,h.strokeRect(m,v,x,O),n<r&&(j[n]=b[n].score),n++}var w=b.map((function(e,t){return e.cropBox})),y=b.map((function(e,t){return e.boxInd})),C=p.g((function(){var e=f.tile([y.length,1,1]).reshape([-1,f.shape[0],f.shape[1],3]);return p.d.cropAndResize(e,w,y,[224,224],"bilinear")})),k=p.g((function(){return c.execute(C).arraySync()}));n=0,a=t.current.length,r=b.length;for(var S=C.arraySync();n<a;){if(n<r){var P=t.current[n];p.a.toPixels(S[n],P),g[n]=k[n][0]}else{t.current[n].getContext("2d").clearRect(0,0,t.current[n].width,t.current[n].height)}n++}C.dispose()}else for(h.clearRect(0,0,ve,me),n=0,a=t.current.length;n<a;){t.current[n].getContext("2d").clearRect(0,0,t.current[n].width,t.current[n].height),n++}return A(j),z(g),e})).then((function(e){for(var t=0,n=e.length;t<n;)p.b(e[t]),t++})).finally((function(){p.b(f),p.b(b)}));case 23:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}();return Object(a.useEffect)((function(){p.f().then((function(e){p.c(),console.log("tfjs is ready")})).then(Ie)}),[]),Object(a.useEffect)((function(){if(null!==J&&null!==G){if(te){var e=setInterval(Ce,100,J,G);return function(){return clearInterval(e)}}console.log("Run on test img"),Ce(J,G)}}),[G,J,he,fe,te,Y]),Object(a.useEffect)((function(){if(!te){var e=new Image;e.src=F,e.onload=function(){Z({oriImgHeight:e.naturalHeight,oriImgWidth:e.naturalWidth})}}}),[te]),Object(a.useEffect)((function(){A(Array(5).fill(null)),z(Array(5).fill(null))}),[5]),Object(a.useEffect)((function(){C().then((function(e){ue(e),e.length>0&&ie(e[0])}))}),[te]),Object(k.jsxs)("div",{className:"App",style:w.root,children:[Object(k.jsxs)("div",{style:Object(s.a)(Object(s.a)({},w.webCamParentPanel),{},{flexBasis:"".concat(65,"%")}),children:[Object(k.jsxs)("div",{style:Object(s.a)(Object(s.a)({},w.webCamPanel),{},{flexBasis:"".concat(70,"%")}),children:[te&&Object(k.jsxs)("div",{style:{},children:[Object(k.jsx)(O.a,{audio:!1,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{height:ve,width:me}),id:"img",ref:e,height:ve,width:me,screenshotQuality:1,screenshotFormat:"image/jpeg",videoConstraints:ye}),Object(k.jsx)("canvas",{id:"myCanvas",height:ve,width:me,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{zIndex:9999,backgroundColor:"transparent"})})]}),!te&&Object(k.jsxs)("div",{style:{},children:[Object(k.jsx)("img",{id:"test_img",src:F,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{height:Oe,width:xe}),height:Oe,width:xe,alt:""}),Object(k.jsx)("canvas",{id:"test_canvas",height:Oe,width:xe,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{zIndex:9999,backgroundColor:"transparent"})})]})]}),Object(k.jsx)("div",{style:Object(s.a)(Object(s.a)({},w.settingPanel),{},{flexBasis:"".concat(30,"%")}),children:Object(k.jsxs)(b.a,{children:[Object(k.jsxs)(h.a,{sx:{m:1,minWidth:220},size:"small",children:[Object(k.jsx)(j.a,{id:"demo-simple-select-autowidth-label",children:"Video Input"}),Object(k.jsx)(m.a,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:re.deviceId,onChange:function(e){ie({deviceName:e.target.name,deviceId:e.target.value})},autoWidth:!0,label:"Video Input",children:le.length>0?le.map((function(e,t){return Object(k.jsx)(g.a,{value:e.deviceId,children:e.deviceName},t)})):Object(k.jsx)(g.a,{value:"",children:""})})]}),Object(k.jsx)(f.a,{control:Object(k.jsx)(v.a,{checked:te,onChange:function(e){ne(e.target.checked)},inputProps:{"aria-label":"controlled"}}),label:"Webcam",labelPlacement:"start"})]})})]}),Object(k.jsx)("div",{style:Object(s.a)(Object(s.a)({},w.faceMaskPanel),{},{flexBasis:"".concat(35,"%")}),children:function(){if(null==J||null==G){var e="Face Detection Model - ".concat(100*r,"%"),n="Mask Classifier Model - ".concat(100*D,"%");return Object(k.jsxs)("div",{children:[Object(k.jsx)("div",{children:"Loading models...."}),Object(k.jsx)("div",{children:e}),Object(k.jsx)("div",{children:n})]})}return t.current.length<1?Object(k.jsx)("div",{children:"Warming up...."}):t.current.map((function(e,n){var a="";return null!==H[n]&&void 0!==H[n]&&null!==_[n]&&void 0!==_[n]&&(a=_[n]>0?"No Mask":"Mask"),Object(k.jsxs)("div",{style:w.faceMaskContainer,children:[Object(k.jsx)("div",{children:a}),Object(k.jsx)("canvas",{ref:function(e){return t.current[n]=e},height:we,width:we,style:{height:we,width:we}}),Object(k.jsx)("div",{children:""}),Object(k.jsx)("div",{children:""})]},n)}))}()})]})},E=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,422)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(k.jsx)(c.a.StrictMode,{children:Object(k.jsx)(D,{})}),document.getElementById("root")),E()}},[[370,1,2]]]);
//# sourceMappingURL=main.2f34927e.chunk.js.map